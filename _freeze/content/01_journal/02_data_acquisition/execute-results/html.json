{
  "hash": "d1a3edaa46fde555078ed43b64e42858",
  "result": {
    "markdown": "---\ntitle: \"Data Acquisition\"\nauthor: \"Jamila Rzayeva\"\n---\n\n# Solution challenge 1\n\n## Load libraries\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-1_dd9e3f8c0ecf216c78d2bb3b93f9d152'}\n\n```{.r .cell-code}\nlibrary(ROpenWeatherMap)\nlibrary(tibble)\n```\n:::\n\n\n## Set API Key (I have to hide this)\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-2_4ccb9a68f891ad6f1765955eec2c86d2'}\n\n```{.r .cell-code}\nAPI_KEY = \"4168e37e031c475c3ac014612bfc9564\"\n```\n:::\n\n\n## Get weather data (as list of lists)\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-3_3c313edce77bcbbb3dbf733b65c7d41e'}\n\n```{.r .cell-code}\ncurrent_weather <- get_current_weather(API_KEY, city = \"Hamburg\")\n```\n:::\n\n\n## Create table from relevant data points\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-4_845c8bdc9c1ebb52a70fab65aa4f8049'}\n\n```{.r .cell-code}\nweather_data <- tibble(weather.type = current_weather$weather$main,\n                       weather.subtype = current_weather$weather$description,\n                       weather.temp = current_weather$main$temp,\n                       weather.feels_like = current_weather$main$feels_like,\n                       weather.temp_min = current_weather$main$temp_min,\n                       weather.temp_max = current_weather$main$temp_max,\n                       weather.pressure = current_weather$main$pressure,\n                       weather.humidity = current_weather$main$humidity,\n                       wind.speed = current_weather$wind$speed,\n                       wind.degree = current_weather$wind$deg)\n```\n:::\n\n\n## Display table\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-5_5e4ad7cebc95fdf57bf16c2deb1ffe6e'}\n\n```{.r .cell-code}\nweather_data\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"weather.type\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"weather.subtype\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"weather.temp\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"weather.feels_like\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"weather.temp_min\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"weather.temp_max\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"weather.pressure\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"weather.humidity\"],\"name\":[8],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"wind.speed\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"wind.degree\"],\"name\":[10],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Rain\",\"2\":\"moderate rain\",\"3\":\"282.38\",\"4\":\"280.4\",\"5\":\"281.47\",\"6\":\"283.31\",\"7\":\"1011\",\"8\":\"93\",\"9\":\"3.6\",\"10\":\"50\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n# Solution challenge 2\n\n## Load libraries\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-6_bf162e064e773d42694f567677fc5472'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.2     ✔ purrr     1.0.1\n#> ✔ forcats   1.0.0     ✔ readr     2.1.4\n#> ✔ ggplot2   3.4.2     ✔ stringr   1.5.0\n#> ✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(glue)\nlibrary(rvest)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'rvest'\n#> \n#> The following object is masked from 'package:readr':\n#> \n#>     guess_encoding\n```\n:::\n:::\n\n\n## Get bike category links\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-7_6748b7fdd0daeeec99db93cd15101a67'}\n\n```{.r .cell-code}\nurl_home <- \"https://www.rosebikes.de/fahrräder\"\nhtml_home <- read_html(url_home)\nbike_cats <- html_home %>%\n  html_nodes(css = \".catalog-navigation__link\")\nlinks <- sapply(bike_cats, function(x) {x %>% html_attr(\"href\")})\nlinks <- links[1:9] %>%\n  enframe(name = \"position\", value = \"subdirectory\") %>%\n  mutate(\n    url = glue(\"https://www.rosebikes.de{subdirectory}\"))  %>%\n  distinct(url)\n```\n:::\n\n\n## Define function to scrape relevant data points\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-8_0123d9e3d9de680910118825f0ffec53'}\n\n```{.r .cell-code}\nget_data <- function(url) {\n  html_bike_cat <- read_html(url)\n  \n  listings <- html_nodes(html_bike_cat, css = '.catalog-category-bikes__price-title') %>% \n    html_text(trim=TRUE) %>%              \n    str_replace_all(\" \",\"\") %>%\n    str_replace_all(\"ab\", \"\") %>%\n    str_replace_all(\"€\", \"\") %>%\n    str_replace_all(\"\\n\", \"\") %>%\n    str_replace_all(\"\\\\.\", \"\") %>%\n    str_replace_all(\",\", \"\\\\.\") %>%\n    iconv('utf-8', 'ascii', sub='') %>%\n    as.numeric()\n  \n  names <- html_nodes(html_bike_cat, xpath = '//basic-headline/h4') %>% \n    html_text() %>%\n    str_replace_all(\"\\n\", \"\") %>%\n    str_to_title()\n  \n  categories <- rep(url %>% str_replace_all(\"https://www.rosebikes.de/fahrräder/\", \"\"), \n              each=length(names)) %>%\n    str_to_title()\n  \n  return(list(\"listings\" = listings, \"names\" = names, \"categories\" = categories))\n}\n```\n:::\n\n\n## Create table from relevant data points\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-9_6053a4c8936da1c4528ba4ffe113430d'}\n\n```{.r .cell-code}\ndata <- get_data(links$url[1])\nbike_data <- tibble(bike.type = data$categories,\n                    bike.name = data$names,\n                    bike.price = as.numeric(data$listings))\nfor (i in 2:9) {\n  data <- get_data(links$url[i])\n  \n  bike_data <- bike_data %>% add_row(bike.type = data$categories,\n                                     bike.name = data$names,\n                                     bike.price = as.numeric(data$listings))\n}\n```\n:::\n\n\n## Display table\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-10_197cb9e34e5468c5dbe3b771c38703c1'}\n\n```{.r .cell-code}\nhead(bike_data, 10)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"bike.type\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"bike.name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"bike.price\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Mtb\",\"2\":\"Count Solo\",\"3\":\"749\"},{\"1\":\"Mtb\",\"2\":\"Psycho Path\",\"3\":\"1499\"},{\"1\":\"Mtb\",\"2\":\"Thrill Hill\",\"3\":\"2999\"},{\"1\":\"Mtb\",\"2\":\"Root Miller Plus\",\"3\":\"4999\"},{\"1\":\"Mtb\",\"2\":\"Ground Control\",\"3\":\"1999\"},{\"1\":\"Mtb\",\"2\":\"Root Miller\",\"3\":\"2299\"},{\"1\":\"Mtb\",\"2\":\"Bonero\",\"3\":\"1499\"},{\"1\":\"Mtb\",\"2\":\"Soul Fire\",\"3\":\"1999\"},{\"1\":\"Mtb\",\"2\":\"The Bruce\",\"3\":\"899\"},{\"1\":\"Rennrad\",\"2\":\"Xlite\",\"3\":\"2999\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}